<behaviourtemplates>

	<is name="adultProcessor">
		{	
			"state" : "none"
		}
	</is>
	
	<javascript>
		<![CDATA[
		
		//are we dealing with a menu request? i.e. it starts with "showmenu_"
		function isMenuRequest(command){
			return command.startsWith("showmenu_");
		}
		
		//strips the first part of the command "showmenu_" and returns the actual menu being requested in lowercase
		function stripMenuRequest(command){
			return command.slice(9).toLowerCase();
		}
		
		function stripExploreEmotion(exploreEmotion){
			return exploreEmotion.slice(7).toLowerCase();
		}
		
		]]>
    </javascript>
      
      
   	<!-- This one takes care of switching menus on the adult tablet -->
    <template id="AdultMenu" name="AdultMenu">
    	<preconditions mode="and">
    		<condition>isMenuRequest(is.tablet.adult.buttonPress.buttonID)</condition>
    	</preconditions>
    	<effects>
    		<assign is="is.adult.menuRequest">stripMenuRequest(is.tablet.adult.buttonPress.buttonID)</assign>
    	</effects>
    </template>
    
    <!-- The following few templates request specific screens on the child's tablet -->
    <template id="MainMenu" name="MainMenu">
    	<preconditions mode="and">
    		<condition>isMenuRequest(is.tablet.adult.buttonPress.buttonID)</condition>
    		<condition>stripMenuRequest(is.tablet.adult.buttonPress.buttonID) === "main"</condition>
    	</preconditions>
    	<effects>
    		<assign is="is.child.menuRequest">"blank"</assign>
    	</effects>
    </template>
    
    <template id="Step2Menu" name="Step2Menu">
    	<preconditions mode="and">
    		<condition>isMenuRequest(is.tablet.adult.buttonPress.buttonID)</condition>
    		<condition>stripMenuRequest(is.tablet.adult.buttonPress.buttonID) === "step2"</condition>
    	</preconditions>
    	<effects>
    		<assign is="is.childProcessor.step2.repeats">0</assign>
    		<assign is="is.child.menuRequest">"step21"</assign>
    	</effects>
    </template>
    
    <template id="Step3Menu" name="Step3Menu">
    	<preconditions mode="and">
    		<condition>isMenuRequest(is.tablet.adult.buttonPress.buttonID)</condition>
    		<condition>stripMenuRequest(is.tablet.adult.buttonPress.buttonID) === "step3"</condition>
    	</preconditions>
    	<effects>
    		<assign is="is.child.menuRequest">"step3"</assign>
    	</effects>
    </template>
    
    <template id="Step3AskFeature" name="Step3AskFeature">
    	<preconditions mode="or">
    		<condition>is.tablet.adult.buttonPress.buttonID === "askEyebrows"</condition>
    		<condition>is.tablet.adult.buttonPress.buttonID === "askEyes"</condition>
    		<condition>is.tablet.adult.buttonPress.buttonID === "askMouth"</condition>
    	</preconditions>
    	<effects>
    		<assign is="is.zeno.request">is.tablet.adult.buttonPress.buttonID</assign>
    		<assign is="is.childProcessor.step3.askedFeature">is.tablet.adult.buttonPress.buttonID</assign>
    		<assign is="is.childProcessor.step3.askedTimestamp">is.behaviourplanner.time</assign>
    		<assign is="is.childProcessor.step3.askedRepeats">0</assign>
    	</effects>
    </template>
    
    <template id="Step4ExploreEmotion" name="Step4ExploreEmotion">
    	<preconditions mode="or">
    		<condition>is.tablet.adult.buttonPress.buttonID === "exploreHappy"</condition>
    		<condition>is.tablet.adult.buttonPress.buttonID === "exploreAngry"</condition>
    		<condition>is.tablet.adult.buttonPress.buttonID === "exploreSad"</condition>
    		<condition>is.tablet.adult.buttonPress.buttonID === "exploreScared"</condition>
    	</preconditions>
    	<effects>
    		<assign is="is.childProcessor.step4.exploreEmotion">stripExploreEmotion(is.tablet.adult.buttonPress.buttonID)</assign>
    		<assign is="is.childProcessor.step4.repeats">0</assign>
    		<assign is="is.child.menuRequest">"step41"</assign>
    	</effects>
    </template>
    
    <template id="SkipSubstep" name="SkipSubstep">
    	<preconditions mode="and">
    		<condition>is.tablet.adult.buttonPress.buttonID === "skip"</condition>
    	</preconditions>
    	<effects>
    		<assign is="is.childProcessor.step2.repeats">is.childProcessor.step2.maxRepeats</assign>
    		<assign is="is.childProcessor.step4.repeats">is.childProcessor.step4.maxRepeats</assign>
    	</effects>
    </template>
    
    <!-- if it's not a menu command, just pass it on to the zeno controller! -->
    <template id="OtherCommand" name="OtherCommand">
    	<preconditions mode="and">
    		<condition>is.tablet.adult.buttonPress.buttonID !== "none"</condition>
    		<condition>!isMenuRequest(is.tablet.adult.buttonPress.buttonID)</condition>
    	</preconditions>
    	<effects>
    		<assign is="is.zeno.request">is.tablet.adult.buttonPress.buttonID</assign>
    	</effects>
    </template>
    
    <!-- This template should always be last!! This gives multiple templates above the chance to simultanously process the input -->
    <template id="AdultCommandCleanup" name="AdultCommandCleanup">
    	<preconditions mode="and">
    		<condition>is.tablet.adult.buttonPress.buttonID !== "none"</condition>
    	</preconditions>
    	<effects>
    		<assign is="is.tablet.adult.buttonPress.buttonID">"none"</assign>
    	</effects>
    </template>
    
</behaviourtemplates>